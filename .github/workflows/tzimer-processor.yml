name: ğŸš€ Tzimer360 Auto Processor

on:
  # ××•×¤×¢×œ ××•×˜×•××˜×™×ª ×›×©××¢×œ×™× affiliate-links.txt
  push:
    paths:
      - 'affiliate-links.txt'
  
  # ××• ×™×“× ×™ ×“×¨×š GitHub UI
  workflow_dispatch:
    inputs:
      urls:
        description: '×§×™×©×•×¨×™ Tzimer360 (××•×¤×¨×“×™× ×‘×©×•×¨×•×ª)'
        required: false
        type: string

jobs:
  process-affiliates:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
      
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
          
      - name: ğŸ“¦ Install Dependencies
        run: |
          pip install --quiet requests beautifulsoup4 python-dotenv Pillow
          
      - name: ğŸ” Process Affiliate Links
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          CLOUDINARY_CLOUD_NAME: dptyfvwyo
          CLOUDINARY_API_KEY: ${{ secrets.CLOUDINARY_API_KEY }}
          CLOUDINARY_API_SECRET: ${{ secrets.CLOUDINARY_API_SECRET }}
        run: |
          python scripts/process_tzimer.py
          
      - name: ğŸ“Š Commit and Push Changes
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "MULTIBRAWN Bot"
          git add -A
          
          # ×‘×“×•×§ ×× ×™×© ×©×™× ×•×™×™×
          if ! git diff --staged --quiet; then
            git commit -m "ğŸ¨ Auto-add properties from Tzimer360"
            git push
            echo "âœ… Changes pushed successfully!"
          else
            echo "â„¹ï¸ No changes to commit"
          fi
          
      - name: ğŸ§¹ Clean up processed links
        if: success()
        run: |
          # × ×§×” ××ª affiliate-links.txt ××—×¨×™ ×¢×™×‘×•×“ ××•×¦×œ×—
          > affiliate-links.txt
          git add affiliate-links.txt
          git commit -m "ğŸ§¹ Clear processed affiliate links" || true
          git push || true
          
      - name: ğŸ“¢ Summary
        if: always()
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ‰ Tzimer360 Processing Complete!"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "Check your staging site:"
          echo "https://staging.multibrawn.co.il/selected"
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
